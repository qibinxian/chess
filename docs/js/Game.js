function ChessGame(){this.Browser=Laya.Browser,this.WebGL=Laya.WebGL,this.Stage=Laya.Stage,this.Stat=Laya.Stat,this.Handler=Laya.Handler,this.Image=Laya.Image,this.Text=Laya.Text,this.Tween=Laya.Tween,this.Sprite=Laya.Sprite,this.Event=Laya.Event,this.Animation=Laya.Animation,this.TimeLine=Laya.TimeLine,Laya.init(750,1624,Laya.WebGL),Laya.stage.scaleMode="fixedwidth",Laya.stage.screenMode=Laya.Stage.SCREEN_VERTICAL,Laya.stage.alignH="center",Laya.stage.alignV="middle",this.mans={},this.promp=[],this.loaded()}ChessGame.prototype={loaded:function(){this.loader=Laya.loader,this.urls=["images/bg.jpg","images/piece.atlas"],this.loader.load(this.urls,this.Handler.create(this,this.onAssetloadedUI),this.Handler.create(this,this.onLoading,null,!1))},onLoading:function(s){console.log("加载进度: "+s)},onAssetloadedUI:function(){this.bg=new this.Sprite,this.bg.loadImage("images/bg.jpg"),Laya.stage.addChild(this.bg),this.Checkerboard=new this.Sprite,this.Checkerboard.loadImage("images/bg.png"),this.Checkerboard.x=50,this.Checkerboard.y=(Laya.stage.height-806)/2,this.bg.addChild(this.Checkerboard),this.createBtn(),this.createMans(),this.loadGambit()},createBtn:function(){this.tyroBtn=new textBtn({fontSize:30,width:200,height:50,leading:10,bold:!0,align:"center",color:"#ffffff",x:50,y:30+(Laya.stage.height-806)/2+806,overflow:Laya.Text.HIDDEN,text:"新手水平"},!0),Laya.stage.addChild(this.tyroBtn),this.tyroBtn.on(Laya.Event.CLICK,this,function(s){new Confirm("确认开始新手级对弈？",this,function(s){if(s){for(var e in this.mans)this.mans[e].destroy();this.createMans(),play.depth=3,play.init()}})}),this.superBtn=new textBtn({fontSize:30,width:200,height:50,leading:10,bold:!0,align:"center",color:"#ffffff",x:275,y:30+(Laya.stage.height-806)/2+806,overflow:Laya.Text.HIDDEN,text:"大师水平"},!0),Laya.stage.addChild(this.superBtn),this.superBtn.on(Laya.Event.CLICK,this,function(s){new Confirm("确认开始大师级对弈？",this,function(s){if(s){for(var e in this.mans)this.mans[e].destroy();this.createMans(),play.depth=5,play.init()}})}),this.regretBtn=new textBtn({fontSize:30,width:200,height:50,leading:10,bold:!0,align:"center",color:"#ffffff",x:500,y:30+(Laya.stage.height-806)/2+806,overflow:Laya.Text.HIDDEN,text:"悔棋"},!0),Laya.stage.addChild(this.regretBtn),this.regretBtn.on(Laya.Event.CLICK,this,function(s){play.isPlay&&1==play.my&&new Confirm("确认悔棋？",this,function(s){s&&play.regret()})}),Laya.stage.on(this.Event.RESIZE,this,function(){this.Checkerboard.y=(Laya.stage.height-806)/2,this.tyroBtn.y=30+(Laya.stage.height-806)/2+806,this.superBtn.y=30+(Laya.stage.height-806)/2+806,this.regretBtn.y=30+(Laya.stage.height-806)/2+806})},createMans:function(){this.mans={};for(var s=this.initMap[0].length,e=this.initMap.length,a=0;a<e;a++)for(var t=0;t<s;t++){let s=this.initMap[a][t];if(s){this.mans[s]=new this.Sprite;var h=this.mans[s];h.CheckerX=t,h.CheckerY=a,h.x=this.stype.spaceX*t+this.stype.pointStartX,h.y=this.stype.spaceY*a+this.stype.pointStartY,h.args=this.args[s.slice(0,1)],h.key=s,h.ps=[],h.loadImage("piece/"+this.args[s.slice(0,1)].img+".png"),h.on(this.Event.CLICK,this,function(e){play.ClickChecker(s)}),h.DropPoint=function(){return Chess.bylaw[this.args.bl](this.CheckerX,this.CheckerY,play.map,this.args.my)}}}},_ManShow:function(){for(let s in this.mans)this.mans[s].x=this.stype.spaceX*this.mans[s].CheckerX+this.stype.pointStartX,this.mans[s].y=this.stype.spaceY*this.mans[s].CheckerY+this.stype.pointStartY,this.Checkerboard.addChild(this.mans[s])},createPromp:function(){this.removePromp();for(var s=0,e=this.mans[play.nowManKey].ps.length;s<e;s++){let e=Laya.Pool.getItemByClass("dot",Laya.Image);e.CheckerX=this.mans[play.nowManKey].ps[s][0],e.CheckerY=this.mans[play.nowManKey].ps[s][1],e.skin="piece/dot.png",e.x=this.stype.spaceX*e.CheckerX+this.stype.pointStartX,e.y=this.stype.spaceY*e.CheckerY+this.stype.pointStartY,this.promp.push(e),e.on(this.Event.CLICK,this,this.clickPoint),this.Checkerboard.addChild(e)}},removePromp:function(){for(var s=0,e=this.promp.length;s<e;s++){var a=this.promp[s];a.off(this.Event.CLICK,this,this.clickPoint),this.Checkerboard.removeChild(a),Laya.Pool.recover("dot",a)}this.promp=[]},clickPoint:function(s){var e={};for(var a in e.x=s.target.CheckerX,e.y=s.target.CheckerY,this.mans)this.mans[a].CheckerX==e.x&&this.mans[a].CheckerY==e.y&&(e.eat=this.mans[a]);play.clickPoint(e)},createSign:function(s){this.start&&this.end?(this.start.visible=!0,this.end.visible=!0):(this.start=new this.Sprite,this.start.loadImage("piece/r_box.png"),this.end=new this.Sprite,this.end.loadImage("piece/r_box.png"),this.Checkerboard.addChild(this.start),this.Checkerboard.addChild(this.end)),this.start.x=this.stype.spaceX*s[0]+this.stype.pointStartX,this.start.y=this.stype.spaceY*s[1]+this.stype.pointStartY,this.end.x=this.stype.spaceX*s[2]+this.stype.pointStartX,this.end.y=this.stype.spaceY*s[3]+this.stype.pointStartY},removeSign:function(){this.start&&this.end&&(this.start.visible=!1,this.end.visible=!1)},loadGambit:function(){var s=Laya.HttpRequest,e=Laya.Event,a=new s;a.once(e.PROGRESS,this,this.onHttpRequestProgress),a.once(e.COMPLETE,this,this.onHttpRequestComplete),a.once(e.ERROR,this,this.onHttpRequestError),a.send("js/gambit.all.js",null,"get","text")},onHttpRequestError:function(s){console.log(s)},onHttpRequestProgress:function(s){},onHttpRequestComplete:function(s){this.gambit=s.split(" "),AI.historyBill=this.gambit}};var Chess=new ChessGame;Chess.initMap=[["C0","M0","X0","S0","J0","S1","X1","M1","C1"],[,,,,,,,,,],[,"P0",,,,,,"P1",,],["Z0",,"Z1",,"Z2",,"Z3",,"Z4"],[,,,,,,,,,],[,,,,,,,,,],["z0",,"z1",,"z2",,"z3",,"z4"],[,"p0",,,,,,"p1",,],[,,,,,,,,,],["c0","m0","x0","s0","j0","s1","x1","m1","c1"]],Chess.value={c:[[206,208,207,213,214,213,207,208,206],[206,212,209,216,233,216,209,212,206],[206,208,207,214,216,214,207,208,206],[206,213,213,216,216,216,213,213,206],[208,211,211,214,215,214,211,211,208],[208,212,212,214,215,214,212,212,208],[204,209,204,212,214,212,204,209,204],[198,208,204,212,212,212,204,208,198],[200,208,206,212,200,212,206,208,200],[194,206,204,212,200,212,204,206,194]],m:[[90,90,90,96,90,96,90,90,90],[90,96,103,97,94,97,103,96,90],[92,98,99,103,99,103,99,98,92],[93,108,100,107,100,107,100,108,93],[90,100,99,103,104,103,99,100,90],[90,98,101,102,103,102,101,98,90],[92,94,98,95,98,95,98,94,92],[93,92,94,95,92,95,94,92,93],[85,90,92,93,78,93,92,90,85],[88,85,90,88,90,88,90,85,88]],x:[[0,0,20,0,0,0,20,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,23,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,20,0,0,0,20,0,0],[0,0,20,0,0,0,20,0,0],[0,0,0,0,0,0,0,0,0],[18,0,0,0,23,0,0,0,18],[0,0,0,0,0,0,0,0,0],[0,0,20,0,0,0,20,0,0]],s:[[0,0,0,20,0,20,0,0,0],[0,0,0,0,23,0,0,0,0],[0,0,0,20,0,20,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,20,0,20,0,0,0],[0,0,0,0,23,0,0,0,0],[0,0,0,20,0,20,0,0,0]],j:[[0,0,0,8888,8888,8888,0,0,0],[0,0,0,8888,8888,8888,0,0,0],[0,0,0,8888,8888,8888,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,8888,8888,8888,0,0,0],[0,0,0,8888,8888,8888,0,0,0],[0,0,0,8888,8888,8888,0,0,0]],p:[[100,100,96,91,90,91,96,100,100],[98,98,96,92,89,92,96,98,98],[97,97,96,91,92,91,96,97,97],[96,99,99,98,100,98,99,99,96],[96,96,96,96,100,96,96,96,96],[95,96,99,96,100,96,99,96,95],[96,96,96,96,96,96,96,96,96],[97,96,100,99,101,99,100,96,97],[96,97,98,98,98,98,98,97,96],[96,96,97,99,99,99,97,96,96]],z:[[9,9,9,11,13,11,9,9,9],[19,24,34,42,44,42,34,24,19],[19,24,32,37,37,37,32,24,19],[19,23,27,29,30,29,27,23,19],[14,18,20,27,29,27,20,18,14],[7,0,13,0,16,0,13,0,7],[7,0,7,0,15,0,7,0,7],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0]]},Chess.value.C=Chess.value.c.arr2Clone().reverse(),Chess.value.M=Chess.value.m.arr2Clone().reverse(),Chess.value.X=Chess.value.x,Chess.value.S=Chess.value.s,Chess.value.J=Chess.value.j,Chess.value.P=Chess.value.p.arr2Clone().reverse(),Chess.value.Z=Chess.value.z.arr2Clone().reverse(),Chess.args={c:{text:"车",img:"r_c",my:1,bl:"c",value:Chess.value.c},m:{text:"马",img:"r_m",my:1,bl:"m",value:Chess.value.m},x:{text:"相",img:"r_x",my:1,bl:"x",value:Chess.value.x},s:{text:"仕",img:"r_s",my:1,bl:"s",value:Chess.value.s},j:{text:"将",img:"r_j",my:1,bl:"j",value:Chess.value.j},p:{text:"炮",img:"r_p",my:1,bl:"p",value:Chess.value.p},z:{text:"兵",img:"r_z",my:1,bl:"z",value:Chess.value.z},C:{text:"車",img:"b_c",my:-1,bl:"c",value:Chess.value.C},M:{text:"馬",img:"b_m",my:-1,bl:"m",value:Chess.value.M},X:{text:"象",img:"b_x",my:-1,bl:"x",value:Chess.value.X},S:{text:"士",img:"b_s",my:-1,bl:"s",value:Chess.value.S},J:{text:"帅",img:"b_j",my:-1,bl:"j",value:Chess.value.J},P:{text:"炮",img:"b_p",my:-1,bl:"p",value:Chess.value.P},Z:{text:"卒",img:"b_z",my:-1,bl:"z",value:Chess.value.Z}},Chess.stype={spaceX:71,spaceY:71,pointStartX:5,pointStartY:42},Chess.bylaw={},Chess.bylaw.c=function(s,e,a,t){for(var h=[],n=s-1;n>=0;n--){if(a[e][n]){Chess.mans[a[e][n]].args.my!=t&&h.push([n,e]);break}h.push([n,e])}for(n=s+1;n<=8;n++){if(a[e][n]){Chess.mans[a[e][n]].args.my!=t&&h.push([n,e]);break}h.push([n,e])}for(n=e-1;n>=0;n--){if(a[n][s]){Chess.mans[a[n][s]].args.my!=t&&h.push([s,n]);break}h.push([s,n])}for(n=e+1;n<=9;n++){if(a[n][s]){Chess.mans[a[n][s]].args.my!=t&&h.push([s,n]);break}h.push([s,n])}return h},Chess.bylaw.m=function(s,e,a,t){var h=[];return!(e-2>=0&&s+1<=8)||play.map[e-1][s]||Chess.mans[a[e-2][s+1]]&&Chess.mans[a[e-2][s+1]].args.my==t||h.push([s+1,e-2]),!(e-1>=0&&s+2<=8)||play.map[e][s+1]||Chess.mans[a[e-1][s+2]]&&Chess.mans[a[e-1][s+2]].args.my==t||h.push([s+2,e-1]),!(e+1<=9&&s+2<=8)||play.map[e][s+1]||Chess.mans[a[e+1][s+2]]&&Chess.mans[a[e+1][s+2]].args.my==t||h.push([s+2,e+1]),!(e+2<=9&&s+1<=8)||play.map[e+1][s]||Chess.mans[a[e+2][s+1]]&&Chess.mans[a[e+2][s+1]].args.my==t||h.push([s+1,e+2]),!(e+2<=9&&s-1>=0)||play.map[e+1][s]||Chess.mans[a[e+2][s-1]]&&Chess.mans[a[e+2][s-1]].args.my==t||h.push([s-1,e+2]),!(e+1<=9&&s-2>=0)||play.map[e][s-1]||Chess.mans[a[e+1][s-2]]&&Chess.mans[a[e+1][s-2]].args.my==t||h.push([s-2,e+1]),!(e-1>=0&&s-2>=0)||play.map[e][s-1]||Chess.mans[a[e-1][s-2]]&&Chess.mans[a[e-1][s-2]].args.my==t||h.push([s-2,e-1]),!(e-2>=0&&s-1>=0)||play.map[e-1][s]||Chess.mans[a[e-2][s-1]]&&Chess.mans[a[e-2][s-1]].args.my==t||h.push([s-1,e-2]),h},Chess.bylaw.x=function(s,e,a,t){var h=[];return 1==t?(!(e+2<=9&&s+2<=8)||play.map[e+1][s+1]||Chess.mans[a[e+2][s+2]]&&Chess.mans[a[e+2][s+2]].args.my==t||h.push([s+2,e+2]),!(e+2<=9&&s-2>=0)||play.map[e+1][s-1]||Chess.mans[a[e+2][s-2]]&&Chess.mans[a[e+2][s-2]].args.my==t||h.push([s-2,e+2]),!(e-2>=5&&s+2<=8)||play.map[e-1][s+1]||Chess.mans[a[e-2][s+2]]&&Chess.mans[a[e-2][s+2]].args.my==t||h.push([s+2,e-2]),!(e-2>=5&&s-2>=0)||play.map[e-1][s-1]||Chess.mans[a[e-2][s-2]]&&Chess.mans[a[e-2][s-2]].args.my==t||h.push([s-2,e-2])):(!(e+2<=4&&s+2<=8)||play.map[e+1][s+1]||Chess.mans[a[e+2][s+2]]&&Chess.mans[a[e+2][s+2]].args.my==t||h.push([s+2,e+2]),!(e+2<=4&&s-2>=0)||play.map[e+1][s-1]||Chess.mans[a[e+2][s-2]]&&Chess.mans[a[e+2][s-2]].args.my==t||h.push([s-2,e+2]),!(e-2>=0&&s+2<=8)||play.map[e-1][s+1]||Chess.mans[a[e-2][s+2]]&&Chess.mans[a[e-2][s+2]].args.my==t||h.push([s+2,e-2]),!(e-2>=0&&s-2>=0)||play.map[e-1][s-1]||Chess.mans[a[e-2][s-2]]&&Chess.mans[a[e-2][s-2]].args.my==t||h.push([s-2,e-2])),h},Chess.bylaw.s=function(s,e,a,t){var h=[];return 1==t?(e+1<=9&&s+1<=5&&(!Chess.mans[a[e+1][s+1]]||Chess.mans[a[e+1][s+1]].args.my!=t)&&h.push([s+1,e+1]),e+1<=9&&s-1>=3&&(!Chess.mans[a[e+1][s-1]]||Chess.mans[a[e+1][s-1]].args.my!=t)&&h.push([s-1,e+1]),e-1>=7&&s+1<=5&&(!Chess.mans[a[e-1][s+1]]||Chess.mans[a[e-1][s+1]].args.my!=t)&&h.push([s+1,e-1]),e-1>=7&&s-1>=3&&(!Chess.mans[a[e-1][s-1]]||Chess.mans[a[e-1][s-1]].args.my!=t)&&h.push([s-1,e-1])):(e+1<=2&&s+1<=5&&(!Chess.mans[a[e+1][s+1]]||Chess.mans[a[e+1][s+1]].args.my!=t)&&h.push([s+1,e+1]),e+1<=2&&s-1>=3&&(!Chess.mans[a[e+1][s-1]]||Chess.mans[a[e+1][s-1]].args.my!=t)&&h.push([s-1,e+1]),e-1>=0&&s+1<=5&&(!Chess.mans[a[e-1][s+1]]||Chess.mans[a[e-1][s+1]].args.my!=t)&&h.push([s+1,e-1]),e-1>=0&&s-1>=3&&(!Chess.mans[a[e-1][s-1]]||Chess.mans[a[e-1][s-1]].args.my!=t)&&h.push([s-1,e-1])),h},Chess.bylaw.j=function(s,e,a,t){var h=[],n=function(s,e){s=Chess.mans.j0.CheckerY;for(var t=Chess.mans.J0.CheckerX,h=(e=Chess.mans.J0.CheckerY,s-1);h>e;h--)if(a[h][t])return!1;return!0}();return 1==t?(e+1<=9&&(!Chess.mans[a[e+1][s]]||Chess.mans[a[e+1][s]].args.my!=t)&&h.push([s,e+1]),e-1>=7&&(!Chess.mans[a[e-1][s]]||Chess.mans[a[e-1][s]].args.my!=t)&&h.push([s,e-1]),Chess.mans.j0.CheckerX==Chess.mans.J0.CheckerX&&n&&h.push([Chess.mans.J0.CheckerX,Chess.mans.J0.CheckerY])):(e+1<=2&&(!Chess.mans[a[e+1][s]]||Chess.mans[a[e+1][s]].args.my!=t)&&h.push([s,e+1]),e-1>=0&&(!Chess.mans[a[e-1][s]]||Chess.mans[a[e-1][s]].args.my!=t)&&h.push([s,e-1]),Chess.mans.j0.CheckerX==Chess.mans.J0.CheckerX&&n&&h.push([Chess.mans.j0.CheckerX,Chess.mans.j0.CheckerY])),s+1<=5&&(!Chess.mans[a[e][s+1]]||Chess.mans[a[e][s+1]].args.my!=t)&&h.push([s+1,e]),s-1>=3&&(!Chess.mans[a[e][s-1]]||Chess.mans[a[e][s-1]].args.my!=t)&&h.push([s-1,e]),h},Chess.bylaw.p=function(s,e,a,t){for(var h=[],n=0,i=s-1;i>=0;i--){if(a[e][i]){if(0==n){n++;continue}Chess.mans[a[e][i]].args.my!=t&&h.push([i,e]);break}0==n&&h.push([i,e])}var r=0;for(i=s+1;i<=8;i++){if(a[e][i]){if(0==r){r++;continue}Chess.mans[a[e][i]].args.my!=t&&h.push([i,e]);break}0==r&&h.push([i,e])}var m=0;for(i=e-1;i>=0;i--){if(a[i][s]){if(0==m){m++;continue}Chess.mans[a[i][s]].args.my!=t&&h.push([s,i]);break}0==m&&h.push([s,i])}var p=0;for(i=e+1;i<=9;i++){if(a[i][s]){if(0==p){p++;continue}Chess.mans[a[i][s]].args.my!=t&&h.push([s,i]);break}0==p&&h.push([s,i])}return h},Chess.bylaw.z=function(s,e,a,t){var h=[];return 1==t?(e-1>=0&&(!Chess.mans[a[e-1][s]]||Chess.mans[a[e-1][s]].args.my!=t)&&h.push([s,e-1]),s+1<=8&&e<=4&&(!Chess.mans[a[e][s+1]]||Chess.mans[a[e][s+1]].args.my!=t)&&h.push([s+1,e]),s-1>=0&&e<=4&&(!Chess.mans[a[e][s-1]]||Chess.mans[a[e][s-1]].args.my!=t)&&h.push([s-1,e])):(e+1<=9&&(!Chess.mans[a[e+1][s]]||Chess.mans[a[e+1][s]].args.my!=t)&&h.push([s,e+1]),s+1<=8&&e>=6&&(!Chess.mans[a[e][s+1]]||Chess.mans[a[e][s+1]].args.my!=t)&&h.push([s+1,e]),s-1>=0&&e>=6&&(!Chess.mans[a[e][s-1]]||Chess.mans[a[e][s-1]].args.my!=t)&&h.push([s-1,e])),h},Chess.createMove=function(s,e,a,t,h){var n,i="",r=this.mans[s[a][e]];(i+=r.args.text,s[h][t]=s[a][e],delete s[a][e],1==r.my)?(t=8-t,i+=(n=["一","二","三","四","五","六","七","八","九","十"])[8-e],h>a?(i+="退","m"==r.pater||"s"==r.pater||"x"==r.pater?i+=n[t]:i+=n[h-a-1]):h<a?(i+="进","m"==r.pater||"s"==r.pater||"x"==r.pater?i+=n[t]:i+=n[a-h-1]):(i+="平",i+=n[t])):(i+=(n=["1","2","3","4","5","6","7","8","9","10"])[e],h>a?(i+="进","M"==r.pater||"S"==r.pater||"X"==r.pater?i+=n[t]:i+=n[h-a-1]):h<a?(i+="退","M"==r.pater||"S"==r.pater||"X"==r.pater?i+=n[t]:i+=n[a-h-1]):(i+="平",i+=n[t]));return i};